<hr>
<h2>
<a id="layout-----posttitle------deploying-apereo-cas-behind-a-proxysummary----a-short-tutorial-on-how-to-get-apereo-cas-deployed-behind-proxies-and-load-balancers-that-aim-to-terminate-ssltags-------cas" class="anchor" href="#layout-----posttitle------deploying-apereo-cas-behind-a-proxysummary----a-short-tutorial-on-how-to-get-apereo-cas-deployed-behind-proxies-and-load-balancers-that-aim-to-terminate-ssltags-------cas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout:     post<br>
title:      Deploying Apereo CAS Behind a Proxy<br>
summary:    A short tutorial on how to get Apereo CAS deployed behind proxies and load balancers that aim to terminate SSL.<br>
tags:       [CAS]</h2>
<!-- raw HTML omitted -->
<p>I suppose the majority of CAS deployments today sit behind some sort of proxy or load balancer, especially with high-availability requirements in mind. F5, HAProxy, etc. In most setups, the proxy upfront terminates SSL and then hands off the request over to CAS on a secured connection typically on port <code>8080</code>. While doing this sort of thing with an external servlet container such as Apache Tomcat is perfectly doable and folks have been doing that for ages, this guide aims to demonstrate how one might go about achieving the same result using the embedded Apache Tomcat container that ships with CAS.</p>
<h1>
<a id="environment" class="anchor" href="#environment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment</h1>
<ul>
<li>CAS <code>5.2.1</code>
</li>
<li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>
<h1>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h1>
<p>We are using the embedded Apache Tomcat container provided by CAS automatically. This is the <em>recommended approach</em> in almost all cases (The embedded bit; not the Apache Tomcat bit) as the container configuration is entirely automated by CAS and its version is guaranteed to be compatible with the running CAS deployment. Furthermore, updates and maintenance of the servlet container are handled at the CAS project level where you as the adopter are only tasked with making sure your deployment is running the latest available release to take advantage of such updates.</p>
<!-- raw HTML omitted -->
<p>So, in order to open up a communication channel between the proxy and the CAS embedded Apache Tomcat server, we want to do the following:</p>
<ol>
<li>Ensure Apache Tomcat runs on port <code>8080</code>, assuming that's what the proxy uses to talk to CAS.</li>
<li>Ensure Apache Tomcat has SSL turned off.</li>
<li>Ensure the Apache Tomcat <em>connector</em> listening on the above port is marked as <code>secure</code>.</li>
</ol>
<p>The above tasklist translates to the following properties expected to be found in your <code>cas.properties</code>:</p>
<pre lang="properties"><code>server.port=8080
server.ssl.enabled=false
cas.server.http.enabled=false
cas.server.httpProxy.enabled=true
cas.server.httpProxy.secure=true
cas.server.httpProxy.scheme=https
cas.server.httpProxy.protocol=HTTP/1.1
</code></pre>
<p>That's all.</p>
<h1>
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Summary</h1>
<p>I hope this review was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your use cases more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>
<p><a href="https://fawnoos.com">Misagh Moayyed</a></p>