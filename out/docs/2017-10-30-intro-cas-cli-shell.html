<hr>
<h2>
<a id="layout-----posttitle------introduction-to-cas-commandline-shellsummary----a-short-review-of-an-interactive-command-line-shell-provided-by-apereo-castags-------cas" class="anchor" href="#layout-----posttitle------introduction-to-cas-commandline-shellsummary----a-short-review-of-an-interactive-command-line-shell-provided-by-apereo-castags-------cas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout:     post<br>
title:      Introduction to CAS Commandline Shell<br>
summary:    A short review of an interactive command-line shell provided by Apereo CAS.<br>
tags:       [CAS]</h2>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Amongst the new features of CAS <code>5.2.x</code> is a <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">command-line tool</a> whose objective is to automate some of the more mundane deployment tasks by tapping into the CAS APIs to provide help on available settings/modules and various other utility functions. This shell engine that is based on <a href="https://projects.spring.io/spring-shell/">Spring Shell</a> is presented as both a CLI utility and an interactive shell.</p>
<p>In this post, I am going to provide an overview of the CAS Shell and enumerate a few utility functions that might prove useful during a CAS deployment.</p>
<h1>
<a id="environment" class="anchor" href="#environment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment</h1>
<ul>
<li>CAS <code>5.2.0-SNAPSHOT</code>
</li>
<li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>
<h1>
<a id="spawn-the-shell" class="anchor" href="#spawn-the-shell" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Spawn The Shell</h1>
<p>While I am using the Maven WAR overlay, note that each CAS WAR Overlay deployment project should already be equipped with this functionality. You should not have to do anything <em>special</em> and extra to interact with the shell. See the relevant overlay documentation and <code>README</code> file for more info on how to invoke and work with the shell.</p>
<p>Specifically applicable to the Maven WAR Overlay, one may launch the CLI by simply executing the following command:</p>
<pre lang="bash"><code>./build.sh cli
</code></pre>
<p>This should present you with the general welcome message as well as a list of command-line options accepted for various functions.</p>
<h1>
<a id="command-line-options" class="anchor" href="#command-line-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Command-line Options</h1>
<p>One of the more useful utilities baked into CAS CLI tool is the ability to search for CAS settings and get better documentation and help on each. All individual CAS properties in most cases carry relevant Javadocs, examples, and links embedded right alongside the field in the housing component. The CAS build process upon every release attempts to collect all settings and their documentation into a JSON metadata file that can be queried by the CLI tool for more info. This of course not only includes CAS specific settings (i.e. <code>cas.authn.xyz=something</code>) but also all other Spring Boot settings and just about any other component that exposes its settings via a <code>@ConfigurationProperties</code>.</p>
<p>If you want to learn more about how this is done, please <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/configuration-metadata.html">see this article</a>.</p>
<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h2>
<!-- raw HTML omitted -->
<h3>
<a id="configuration-metadata" class="anchor" href="#configuration-metadata" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration Metadata</h3>
<p>Let's say we are looking for additional documentation on <code>duoApplicationKey</code>. To run the search, use:</p>
<pre lang="bash"><code># Skipping the CAS Banner via `-skb` 
./build.sh cli -skb -p duoApplicationKey
</code></pre>
<p>Cool, but maybe that's too limiting. How about notes on every setting in CAS that deals with <code>duo</code>?</p>
<pre lang="bash"><code>./build.sh cli -skb -p duo.+
</code></pre>
<p>The output seems too verbose. How about we compact it a little bit?</p>
<pre lang="bash"><code>./build.sh cli -skb -p duo.+ --summary
</code></pre>
<p>Nice. What about some other non-CAS setting like, I don't know, <code>maxHttpPostSize</code>?</p>
<pre lang="bash"><code>./build.sh cli -p maxHttpPostSize -skb
</code></pre>
<p>You see the above setting applies to Tomcat, Jetty and a few more. Here is a slightly fancier and more direct version:</p>
<pre lang="bash"><code>./build.sh cli -p server.tomcat.max-http-post-size -skb
</code></pre>
<h3>
<a id="others" class="anchor" href="#others" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Others</h3>
<p>Other CLI options include the following:</p>
<ul>
<li>Generating JWTs: <code>./build.sh cli -gw -sub Misagh -skb</code>
</li>
<li>Generating keys for a CAS setting group that requires signing/encryption keys: <code>./build.sh cli -gk -p cas.tgc -skb</code>
</li>
<li>...</li>
</ul>
<p>As more options and commands are added to the CLI, you should always confirm new additions by simply running <code>./build.sh cli -h -skb</code> to get a listing of all options.</p>
<h1>
<a id="interactive-shell" class="anchor" href="#interactive-shell" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Interactive Shell</h1>
<p>There is also an interactive shell which essentially provides identical functionality to the CLI yet it is more flexible and powerful in many ways. Some of the key highlights include:</p>
<ul>
<li>A simple, annotation-driven, programming model to contribute custom commands</li>
<li>Tab completion, colorization, and script execution</li>
<li>Already built-in commands, such as clear screen, gorgeous help, exit</li>
</ul>
<p>You can simply launch into the shell via <code>./build.sh cli -sh</code>. While in the shell, simply type <code>quit</code> to exit the shell.</p>
<h2>
<a id="shell-commands" class="anchor" href="#shell-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shell Commands</h2>
<p>In addition to a number built-in commands such as <code>help</code>, <code>version</code> and the most useful <code>cls</code> or <code>clear</code>, the following CAS-provided commands are available.</p>
<p>Remember:</p>
<ul>
<li>Use double-tab to take advantage of auto-completion and history.</li>
<li>Use <code>help</code> to see a listing of all commands.</li>
<li>Use <code>help &lt;command-name&gt;</code> to learn more about the command itself.</li>
</ul>
<h3>
<a id="find" class="anchor" href="#find" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Find</h3>
<p>Identical to its CLI equivalent, allows one to look up a CAS setting:</p>
<pre lang="bash"><code>cas&gt;find --name duo
</code></pre>
<h3>
<a id="undocumented-settings" class="anchor" href="#undocumented-settings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Undocumented Settings</h3>
<p>Acts as a sanity check and lists undocumented properties for which allowing contributors to step up and contribute to the documentation:</p>
<pre lang="bash"><code>cas&gt;list-undocumented
</code></pre>
<h3>
<a id="generate-jwts" class="anchor" href="#generate-jwts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generate JWTs</h3>
<p>Identical to its CLI equivalent:</p>
<pre lang="bash"><code>cas&gt;generate-jwt --subject Misagh
</code></pre>
<h3>
<a id="generate-crypto-keys" class="anchor" href="#generate-crypto-keys" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Generate Crypto Keys</h3>
<p>Identical to its CLI equivalent:</p>
<pre lang="bash"><code>cas&gt;generate-key --group cas.tgc
</code></pre>
<h3>
<a id="json-to-yaml" class="anchor" href="#json-to-yaml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON To YAML</h3>
<p>Convert a CAS service definition file in JSON to YAML and optionally save the file at path:</p>
<pre lang="bash"><code>cas&gt;generate-yaml /etc/cas/config/services/WSFED-400.json --destination /etc/cas/config/services/WSFED-400.yml
</code></pre>
<h3>
<a id="validate-service" class="anchor" href="#validate-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validate Service</h3>
<p>Validate a service definition file in JSON or YAML to ensure correctness of syntax. Note that this command should and does support all service types (SAML2, OAuth, etc) provided by CAS:</p>
<pre lang="bash"><code>cas&gt;validate-service --file /etc/cas/config/services/WSFED-400.json
</code></pre>
<h3>
<a id="add-properties" class="anchor" href="#add-properties" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add Properties</h3>
<p>All associated settings with a given property group are added to the properties file defined. Existing values should be preserved.</p>
<pre lang="bash"><code>cas&gt;add-properties --group cas.tgc --file /etc/cas/config/my.properties
</code></pre>
<h1>
<a id="extending-commands" class="anchor" href="#extending-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Extending Commands</h1>
<p>When the shell is launched with the <code>-sh</code> option, all components under the <code>org.apereo.cas.shell</code> that are annotated with <code>org.springframework.stereotype.Service</code> are picked up as command implementations.</p>
<p>The outline of a given command is as such:</p>
<pre lang="java"><code>package org.apereo.cas.shell.commands;

@Service
public class DoesStuffCommand implements CommandMarker {
   
    @CliCommand(value = "do-stuff", help = "This does stuff")
    public void doStuff() {
       ...
    }
}
</code></pre>
<p>If you are interested in adding new and fancier commands, by all means create your own based on the above outline and contribute back.</p>
<h1>
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Summary</h1>
<p>I hope this review was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your use cases more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>
<p><a href="https://fawnoos.com">Misagh Moayyed</a></p>