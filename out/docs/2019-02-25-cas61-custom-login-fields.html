<hr>
<h2>
<a id="layout-----posttitle------apereo-cas---custom-login-fields-w-dynamic-bindingssummary----learn-how-to-extend-the-spring-webflow-model-to-add-custom-fields-to-the-cas-login-form-and-the-authentication-process-and-take-advantage-of-the-additional-user-provided-data-in-customized-authentication-handlerstags-------cas" class="anchor" href="#layout-----posttitle------apereo-cas---custom-login-fields-w-dynamic-bindingssummary----learn-how-to-extend-the-spring-webflow-model-to-add-custom-fields-to-the-cas-login-form-and-the-authentication-process-and-take-advantage-of-the-additional-user-provided-data-in-customized-authentication-handlerstags-------cas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout:     post<br>
title:      Apereo CAS - Custom Login Fields w/ Dynamic Bindings<br>
summary:    Learn how to extend the Spring Webflow model to add custom fields to the CAS login form and the authentication process and take advantage of the additional user-provided data in customized authentication handlers.<br>
tags:       [CAS]</h2>
<!-- raw HTML omitted -->
<p>Despite what you may have heard, I am here to put a stop to all rumors and clarify definitively that this blog post has nothing to do with Taylor Swift. Instead, this post deals with a pretty simple CAS use case, which is:</p>
<blockquote>
<p>How does one include additional fields into the login form and get access to field data in a custom CAS authentication handler?</p>
</blockquote>
<p>Sounds quite legitimate. Let's start with the simpler answer, which is that any CAS authentication handler can always directly tap into the <code>HttpServletRequest</code> object to query and fetch parameters passed by the login form and other views. One could do this in <em>Spring Framework speech</em> using something like:</p>
<pre lang="java"><code>...
HttpServletRequest request = ((ServletRequestAttributes)
  RequestContextHolder.currentRequestAttributes()).getRequest();
Object parameter = request.getParameter("whatever");
...
</code></pre>
<p>If this feels a bit uncomfortable, let's dig deeper to see how CAS might accommodate this use case in more <em>official</em> ways.</p>
<p>Our starting position is based on:</p>
<ul>
<li>CAS <code>6.1.x</code>
</li>
<li>Java <code>11</code>
</li>
<li><a href="https://github.com/apereo/cas-overlay-template">CAS WAR Overlay</a></li>
</ul>
<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h2>
<p>CAS presents the ability to augment the login form to include additional custom fields. These fields are taught to CAS using settings that describe modest behavior and tweaks for each and are then processed by the Spring Webflow engine to be <em>bound</em> to the object model that is ultimately in charge of handling and managing user input.</p>
<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2>
<p>So imagine that in addition to the usual <code>username</code> and <code>password</code> fields you also wanted to ask the user for their <code>phone</code> as a mandatory field. To do this, you'd teach CAS about the new <code>phone</code> field:</p>
<pre lang="properties"><code>cas.view.customLoginFormFields.phone.messageBundleKey=customLoginFormField.phone
cas.view.customLoginFormFields.phone.required=true
</code></pre>
<p>The CAS message/language bundle, typically <code>custom_messages.properties</code> file, should also contain the text for the new field:</p>
<pre lang="properties"><code>customLoginFormField.phone=Telephone
customFields[phone].required=Telephone number must be specified.
</code></pre>
<p>If you build and bring up CAS, you might see something like this:</p>
<p><img src="https://user-images.githubusercontent.com/1205228/53297205-1a95cf80-37d8-11e9-9f82-aa1a2386aca3.png" alt="image"></p>
<p>...and if you attempt to submit the form without the <code>phone</code> field:</p>
<p><img src="https://user-images.githubusercontent.com/1205228/53297209-35684400-37d8-11e9-996b-b173cf1c6040.png" alt="image"></p>
<h2>
<a id="authentication-handling" class="anchor" href="#authentication-handling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authentication Handling</h2>
<p>Next, let's say you have registered the following authentication handler with CAS:</p>
<pre lang="java"><code>public class MyAuthenticationHandler extends AbstractUsernamePasswordAuthenticationHandler {
    ...
    protected AuthenticationHandlerExecutionResult authenticateUsernamePasswordInternal(
        final UsernamePasswordCredential credential, final String originalPassword) {
        ...
    }
    ...
}
</code></pre>
<p>To receive and process the new <code>phone</code> field in your custom authentication handler, you would do something like:</p>
<pre lang="java"><code>protected AuthenticationHandlerExecutionResult authenticateUsernamePasswordInternal(
    final UsernamePasswordCredential credential, final String originalPassword) {
    Object phone = credential.getCustomFields().get("phone");
    ...
}
</code></pre>
<h2>
<a id="finale" class="anchor" href="#finale" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Finale</h2>
<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>
<p><a href="https://fawnoos.com">Misagh Moayyed</a></p>