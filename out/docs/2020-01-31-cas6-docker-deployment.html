<hr>
<h2>
<a id="layout-----posttitle------apereo-cas---dockerized-deploymentssummary----review-a-number-of-strategies-that-allow-to-create-docker-images-for-your-cas-deployment-and-run-docker-containers-with-easetags-------cas" class="anchor" href="#layout-----posttitle------apereo-cas---dockerized-deploymentssummary----review-a-number-of-strategies-that-allow-to-create-docker-images-for-your-cas-deployment-and-run-docker-containers-with-easetags-------cas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout:     post<br>
title:      Apereo CAS - Dockerized Deployments<br>
summary:    Review a number of strategies that allow to create Docker images for your CAS deployment and run Docker containers with ease.<br>
tags:       [CAS]</h2>
<p>CAS <a href="https://github.com/apereo/cas-webapp-docker">embraced Docker</a> a while ago by providing a sample <code>Dockerfile</code> template to kickstart the builds. Since then, both configuration and technology have evolved greatly to simplify Docker-based deployments of CAS in much easier and hassle-free ways. This tutorial begins to review strategies that exist today to allow a CAS adopter to create Docker images for a CAS deployment and run containers with ease.</p>
<p>Our starting position is based on the following:</p>
<ul>
<li>CAS <code>6.2.x</code>
</li>
<li>Java 11</li>
<li>
<a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code>master</code> branch specifically)</li>
<li><a href="https://www.docker.com/get-started">Docker</a></li>
</ul>
<h2>
<a id="jib" class="anchor" href="#jib" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Jib</h2>
<p><a href="https://github.com/GoogleContainerTools/jib">Jib</a> is an open-source Java containerizer from Google. It is a container image builder that handles all the steps of packaging the CAS web application into a container image. It does not require you to write a Dockerfile or have Docker installed, and it is directly integrated into CAS WAR overlay.</p>
<p>Once you have cloned the CAS WAR overlay, you can examine the relevant task via:</p>
<pre lang="bash"><code>./gradlew tasks

Jib tasks
---------
jib - Builds a container image to a registry.
jibBuildTar - Builds a container image to a tarball.
jibDockerBuild - Builds a container image to a Docker daemon.
</code></pre>
<p>You can build Docker image direcly with jib using:</p>
<pre lang="bash"><code>./gradlew jibDockerBuild

Setting image creation time to current time; your image may not be reproducible.

Containerizing application to Docker daemon as org.apereo.cas/cas:v6.2.0-SNAPSHOT...
Base image 'adoptopenjdk/openjdk11:alpine-jre' does not use a 
specific image digest - build may not be reproducible
The base image requires auth. Trying again for adoptopenjdk/openjdk11:alpine-jre...
The credential helper (docker-credential-desktop) has 
nothing for server URL: registry-1.docker.io

Got output:

credentials not found in native keychain

The credential helper (docker-credential-desktop) 
has nothing for server URL: registry.hub.docker.com

Got output:

credentials not found in native keychain

Using base image with digest: sha256:5c87145a62b49a7620

Container entrypoint set to [docker/entrypoint.sh]

Built image to Docker daemon as org.apereo.cas/cas:v6.2.0-SNAPSHOT
Executing tasks:
[==============================] 100.0% complete
</code></pre>
<p>Next, you can exmaine your available Docker images:</p>
<pre lang="bash"><code>$ docker images
REPOSITORY                       TAG                                IMAGE ID            CREATED              SIZE
org.apereo.cas/cas               v6.2.0-SNAPSHOT                    7e9c1d4b3ce0        About a minute ago   358MB
</code></pre>
<p>Certain configuration elements about the Docker images, such as the base image can be controlled via the <code>gradle.propeties</code> file. For more<br>
details, please review <code>gradle/dockerjib.gradle</code> file.</p>
<h2>
<a id="docker" class="anchor" href="#docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker</h2>
<p>If you prefer a more traditional approach via a native <code>Dockerfile</code>, there is one provided for you in the Overlay that can be built via:</p>
<pre lang="bash"><code>./docker-build.sh

...
Successfully built 83c945802e31
Successfully tagged apereo/cas:v6.2.0-SNAPSHOT
Built CAS image successfully tagged as apereo/cas:v6.2.0-SNAPSHOT
REPOSITORY                  TAG                 IMAGE ID            CREATED                  SIZE
org.apereo.cas/cas          v6.2.0-SNAPSHOT     83c945802e31        Less than a second ago   249MB
</code></pre>
<h2>
<a id="docker-compose" class="anchor" href="#docker-compose" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker Compose</h2>
<p>For convenience, an additional <code>docker-compose.yml</code> is also provided to orchestrate the build, as modest as it may be:</p>
<pre lang="bash"><code>docker-compose build

Successfully built a8b5b2d1b90e
Successfully tagged org.apereo.cas/cas:v6.2.0-SNAPSHOT
Built CAS image successfully tagged as org.apereo.cas/cas:v6.2.0-SNAPSHOT
REPOSITORY           TAG                 IMAGE ID            CREATED                  SIZE
org.apereo.cas/cas   v6.2.0-SNAPSHOT     a8b5b2d1b90e        Less than a second ago   249MB
</code></pre>
<h2>
<a id="finale" class="anchor" href="#finale" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Finale</h2>
<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>
<p><a href="https://fawnoos.com">Misagh Moayyed</a></p>