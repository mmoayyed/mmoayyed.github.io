<hr>
<h2>
<a id="layout-----posttitle------apereo-cas---google-recaptcha-integrationsummary----learn-to-set-up-an-integration-between-apereo-cas-and-google-recaptchatags-------cas" class="anchor" href="#layout-----posttitle------apereo-cas---google-recaptcha-integrationsummary----learn-to-set-up-an-integration-between-apereo-cas-and-google-recaptchatags-------cas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout:     post<br>
title:      Apereo CAS - Google reCAPTCHA Integration<br>
summary:    Learn to set up an integration between Apereo CAS and Google reCAPTCHA.<br>
tags:       [CAS]</h2>
<!-- raw HTML omitted -->
<h1>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>
<p><a href="https://developers.google.com/recaptcha">reCAPTCHA</a> is a Google service that protects websites from<br>
spam and abuse. It uses advanced risk analysis techniques to tell humans and bots apart. This brief<br>
demonstrates how Apereo CAS may be configured to integrate with the Google reCAPTCHA API v2 and v3.</p>
<p>Our starting position is based on:</p>
<ul>
<li>CAS <code>6.2.x</code>
</li>
<li>Java <code>11</code>
</li>
<li><a href="https://github.com/apereo/cas-overlay-template">CAS WAR Overlay</a></li>
<li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code>jq</code></a></li>
</ul>
<h1>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h1>
<h2>
<a id="recaptcha-v2" class="anchor" href="#recaptcha-v2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>reCAPTCHA v2</h2>
<p>Let's register our CAS server instance with Google to obtain a few integration keys:</p>
<p><img src="https://user-images.githubusercontent.com/1205228/68384146-66bf4f00-0170-11ea-83be-0839615921fc.png" alt="image"></p>
<p>Next, once <a href="https://apereo.github.io/cas/development/integration/Configuring-Google-reCAPTCHA.html">the reCAPTCHA module</a> is included in the WAR Overlay, we can begin to register the integration keys with CAS configuration:</p>
<pre lang="properties"><code>cas.googleRecaptcha.siteKey=6Let...
cas.googleRecaptcha.secret=6Let...
</code></pre>
<p>That should be all. Build and deploy and the very next time you bring up the CAS login screen, you should automatically be presented with reCAPTCHA:</p>
<p><img src="https://user-images.githubusercontent.com/1205228/68384529-3cba5c80-0171-11ea-8e21-304938be08d4.png" alt="image"></p>
<h2>
<a id="recaptcha-v3" class="anchor" href="#recaptcha-v3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>reCAPTCHA v3</h2>
<p>Integration with reCAPTCHA v3 is exactly the same; you will need to register CAS with Google reCAPTCHA v3 again to obtain v3-specific integration keys. Then,<br>
the reCAPTCHA version needs to be updated to match the integration version:</p>
<pre lang="properties"><code>cas.googleRecaptcha.siteKey=6Ld5...
cas.googleRecaptcha.secret=6Ld5I...
cas.googleRecaptcha.version=V3
</code></pre>
<h2>
<a id="recaptcha-score" class="anchor" href="#recaptcha-score" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>reCAPTCHA Score</h2>
<p>Google reCAPTCHA returns a score (<code>1.0</code> is very likely a good interaction, <code>0.0</code> is very likely a bot). Based on the score, one can take variable action in a specific context. By default, CAS allows for a static single score in the configuration that is compared against the reCAPTCHA response. If the returned score is less than what CAS requires, the authentication attempt would be blocked.</p>
<pre lang="properties"><code>cas.googleRecaptcha.score=0.5
</code></pre>
<h2>
<a id="bonus" class="anchor" href="#bonus" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bonus</h2>
<p>You can of course inject your own reCAPTCHA validation logic into CAS for more advanced scenarios. To supply your own validator, you should<br>
start by <a href="https://apereo.github.io/cas/development/configuration/Configuration-Management-Extensions.html">designing your own configuration component</a> to<br>
include the following bean:</p>
<pre lang="java"><code>@Bean
public Action validateCaptchaAction() {
    return new MyValidateCaptchaAction(...);
}
</code></pre>
<p>All you would have to do is to implement the <code>org.springframework.webflow.execution.Action</code> interface in the <code>MyValidateCaptchaAction</code>.</p>
<h1>
<a id="so" class="anchor" href="#so" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>So...</h1>
<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please know that all other use cases, scenarios, features, and theories certainly <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">are possible</a> as well. Feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>
<p>Finally, if you benefit from Apereo CAS as free and open-source software, we invite you to <a href="https://www.apereo.org/content/apereo-membership">join the Apereo Foundation</a> and financially support the project at a capacity that best suits your deployment. If you consider your CAS deployment to be a critical part of the identity and access management ecosystem and care about its long-term success and sustainability, this is a viable option to consider.</p>
<p>Happy Coding,</p>
<p><a href="https://fawnoos.com">Misagh Moayyed</a></p>