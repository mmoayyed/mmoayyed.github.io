<hr>
<h2>
<a id="layout-----posttitle------apereo-cas---event-filteringsummary----learn-how-to-filter-events-that-are-tracked-by-cas-event-repositories-and-persistence-enginetags-------casbackground-imageshomeslide-1jpg" class="anchor" href="#layout-----posttitle------apereo-cas---event-filteringsummary----learn-how-to-filter-events-that-are-tracked-by-cas-event-repositories-and-persistence-enginetags-------casbackground-imageshomeslide-1jpg" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>layout:     post<br>
title:      Apereo CAS - Event Filtering<br>
summary:    Learn how to filter events that are tracked by CAS event repositories and persistence engine.<br>
tags:       [CAS]<br>
background: '/images/home/slide-1.jpg'</h2>
<h1>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>
<p>CAS provides a facility for consuming and <a href="https://apereo.github.io/cas/development/installation/Configuring-Authentication-Events.html">recording authentication events</a> into persistent storage. Events are primarily designed to be consumed by the developer and subsequent CAS modules and track a variety of types throughout the CAS lifecycle. While by default, all events are loaded and persisted in the underlying storage, there may be scenarios where one would prefer to dynamically filter out certain events. This quick blog posts demonstrates a strategy to activate event filtering in CAS.</p>
<p>Our starting position is based on:</p>
<ul>
<li>CAS <code>6.2.x</code>
</li>
<li>Java <code>11</code>
</li>
<li><a href="https://github.com/apereo/cas-overlay-template">CAS WAR Overlay</a></li>
</ul>
<h1>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h1>
<p>In order to design an event filter, you should start by <a href="https://apereo.github.io/cas/development/configuration/Configuration-Management-Extensions.html">designing your own configuration component</a> to include the following bean:</p>
<pre lang="java"><code>@Bean
public CasEventRepositoryFilter casEventRepositoryFilter() {
    var resource = new ClassPathResource("GroovyCasEventRepositoryFilter.groovy");
    return new GroovyCasEventRepositoryFilter(resource);
}
</code></pre>
<p>We are outsourcing the event filtering task to a Groovy script whose responsibility to determine if events quality for storage, etc. The outline of the script itself should match the below example:</p>
<pre lang="groovy"><code>def shouldSaveEvent(Object[] args) {
    def event = args[0]
    def logger = args[1]

    logger.debug("Decide whether ${event} should be saved...")
    /*
    Return true if event should be saved.
    Otherwise, return false.
    */
    true
}
</code></pre>
<p>The callback in the above Groovy script is invoked before the event is saved to determine the eligibility criteria. The script receives a <code>event</code> object of type <code>CasEvent</code> and a <code>logger</code> that could be used to output messages to the configured CAS log.</p>
<h1>
<a id="so" class="anchor" href="#so" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>So...</h1>
<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please know that all other use cases, scenarios, features, and theories certainly <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">are possible</a> as well. Feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>
<p>Happy Coding,</p>
<p><a href="https://fawnoos.com">Misagh Moayyed</a></p>